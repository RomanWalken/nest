"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@nestjs/core");
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const app_module_1 = require("./app.module");
const mongo_exception_filter_1 = require("./common/filters/mongo-exception.filter");
const helmet_1 = require("helmet");
async function bootstrap() {
    const app = await core_1.NestFactory.create(app_module_1.AppModule);
    app.use((0, helmet_1.default)({
        contentSecurityPolicy: process.env.NODE_ENV === 'production' ? undefined : false,
        crossOriginEmbedderPolicy: false,
    }));
    app.useGlobalPipes(new common_1.ValidationPipe({
        whitelist: true,
        forbidNonWhitelisted: true,
        transform: true
    }));
    app.useGlobalFilters(new mongo_exception_filter_1.MongoExceptionFilter());
    app.enableCors({
        origin: process.env.NODE_ENV === 'production'
            ? ['https://yourdomain.com', 'https://app.yourdomain.com']
            : ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:8080'],
        methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
        allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
        credentials: true,
    });
    if (process.env.NODE_ENV !== 'production') {
        const config = new swagger_1.DocumentBuilder()
            .setTitle('Online Courses Platform API')
            .setDescription(`
      ## –û–ø–∏—Å–∞–Ω–∏–µ API

      **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤** - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, 
      —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π. –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É 
      –¥–ª—è —Å–≤–æ–∏—Ö –∫—É—Ä—Å–æ–≤.

      ### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
      - üè¢ **–ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥–∞—è –∫–æ–º–ø–∞–Ω–∏—è –∏–º–µ–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ä–µ–¥—É
      - üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: –†–æ–ª–∏, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, –ø—Ä–æ—Ñ–∏–ª–∏
      - üìö **–ö—É—Ä—Å—ã –∏ –º–æ–¥—É–ª–∏**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
      - üí∞ **–¢–∞—Ä–∏—Ñ—ã –∏ –ø–æ–∫—É–ø–∫–∏**: –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
      - üìä **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      - üçΩÔ∏è **–ü–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è**: –î–ª—è —Ñ–∏—Ç–Ω–µ—Å –∏ wellness –∫—É—Ä—Å–æ–≤

      ### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
      - **Backend**: NestJS, MongoDB, Mongoose
      - **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT, Passport (Local, Google, Facebook)
      - **–ü–ª–∞—Ç–µ–∂–∏**: Stripe, WayForPay
      - **–§–∞–π–ª—ã**: UploadThings, Bunny.net (–≤–∏–¥–µ–æ)
      - **Email**: SendPulse

      ### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
      - **Student**: –ë–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å–∞–º
      - **Moderator**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      - **Admin**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–µ–π
      - **Superadmin**: –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∞–≤–∞

      ### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
      API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer —Ç–æ–∫–µ–Ω—ã. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç /auth/login –∏–ª–∏ /auth/register.
    `)
            .setVersion('1.0.0')
            .addTag('auth', '–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
            .addTag('users', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã')
            .addTag('companies', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å')
            .addTag('courses', '–°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏')
            .addTag('course-modules', '–ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–æ–≤ –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞')
            .addTag('lessons', '–£—Ä–æ–∫–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç')
            .addTag('tariffs', '–¢–∞—Ä–∏—Ñ—ã –∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ–≤')
            .addTag('meals', '–ü–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è wellness –∫—É—Ä—Å–æ–≤')
            .addTag('user-progress', '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è')
            .addTag('purchases', '–ü–æ–∫—É–ø–∫–∏ –∫—É—Ä—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º')
            .addBearerAuth({
            type: 'http',
            scheme: 'bearer',
            bearerFormat: 'JWT',
            name: 'JWT',
            description: '–í–≤–µ–¥–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω',
            in: 'header',
        }, 'JWT-auth')
            .addServer('http://localhost:3000', '–õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏')
            .addServer('https://api.example.com', '–ü—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä')
            .build();
        const document = swagger_1.SwaggerModule.createDocument(app, config);
        swagger_1.SwaggerModule.setup('api', app, document, {
            swaggerOptions: {
                persistAuthorization: true,
                docExpansion: 'list',
                filter: true,
                showRequestDuration: true,
                tryItOutEnabled: true,
            },
            customSiteTitle: 'Online Courses Platform API',
            customCss: `
      .swagger-ui .topbar { display: none }
      .swagger-ui .info .title { font-size: 2.5em; color: #3b82f6; }
      .swagger-ui .info .description { font-size: 1.1em; line-height: 1.6; }
      .swagger-ui .info .description h3 { color: #1f2937; margin-top: 1.5em; }
      .swagger-ui .info .description ul { margin-left: 1.5em; }
      .swagger-ui .info .description li { margin-bottom: 0.5em; }
      .swagger-ui .scheme-container { background: #f8fafc; padding: 1em; border-radius: 0.5em; }
      .swagger-ui .scheme-container .schemes-title { font-weight: bold; color: #374151; }
      .swagger-ui .scheme-container .schemes-container { margin-top: 0.5em; }
      .swagger-ui .scheme-container .schemes-container button { 
        background: #3b82f6; 
        color: white; 
        border: none; 
        padding: 0.5em 1em; 
        border-radius: 0.25em; 
        cursor: pointer; 
      }
      .swagger-ui .scheme-container .schemes-container button:hover { background: #2563eb; }
    `,
        });
    }
    const port = process.env.PORT || 3000;
    await app.listen(port);
    console.log(`üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É ${port}`);
    if (process.env.NODE_ENV !== 'production') {
        console.log(`üìö Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:${port}/api`);
    }
    console.log(`üåê API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:${port}`);
}
bootstrap();
//# sourceMappingURL=main.js.map